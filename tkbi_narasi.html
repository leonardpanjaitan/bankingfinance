<!DOCTYPE html>

<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>TKBI v3 Narasi</title>

<script src="https://cdn.tailwindcss.com"></script>

<!-- Anti cache -->

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<style>
body { font-family: Inter, Arial; }
.tree-item { cursor: pointer; }
</style>

</head>

<body class="bg-gray-100">

<div class="container mx-auto p-6">

<h1 class="text-3xl font-bold text-[#003f5c] mb-6">
TKBI v3 – Narasi Teknis
</h1>

<div id="treeContainer" class="bg-white p-6 rounded shadow">
Loading...
</div>

<div class="mt-6">
<a href="index.html" class="bg-gray-800 text-white px-5 py-2 rounded">
Back
</a>
</div>

</div>

<script>

const VERSION = new Date().getTime();

// ===== LOAD JSON =====
fetch("tkbi_v3_hierarchy_indonesia_correct.json?v=" + VERSION)
.then(r => r.json())
.then(data => buildExplorer(data))
.catch(err => {
document.getElementById("treeContainer").innerHTML =
"Error membaca JSON";
console.error(err);
});

// ===== BUILD =====
function buildExplorer(data){

let flat = [];

// LOOP SEKTOR → TSC → KBLI
Object.keys(data).forEach(sektor => {

Object.keys(data[sektor]).forEach(tsc => {

Object.keys(data[sektor][tsc]).forEach(kbli => {

const obj = data[sektor][tsc][kbli];

flat.push({
sektor,
tsc,
kbli,
aktivitas: obj.Aktivitas || "",
klasifikasi: obj.Klasifikasi || "",
pilar: obj.Pilar || [],
dnsh: obj.DNSH || [],
safeguards: obj.Safeguards || [],
logic: obj.Logic || []
});

});

});

});

render(flat);
}

// ===== RENDER =====
function render(data){

const container = document.getElementById("treeContainer");
container.innerHTML = "";

const grouped = {};

data.forEach(x => {
if(!grouped[x.sektor]) grouped[x.sektor] = [];
grouped[x.sektor].push(x);
});

Object.keys(grouped).forEach(sektor => {

const div = document.createElement("div");

const header = document.createElement("div");
header.innerHTML = "▶ " + sektor;
header.className = "font-bold text-lg tree-item";

const body = document.createElement("div");
body.style.display = "none";

header.onclick = () => {
body.style.display = body.style.display === "none" ? "block" : "none";
};

grouped[sektor].forEach(row => {

const card = document.createElement("div");
card.className = "border p-3 mt-2";

card.innerHTML = `
<b>${row.aktivitas}</b><br>
KBLI: ${row.kbli}<br>
Klasifikasi: ${row.klasifikasi}<br>
Pilar: ${row.pilar.join(", ")}<br>
DNSH: ${row.dnsh.join(", ")}<br>
Safeguards: ${row.safeguards.join(", ")}<br>
Logic: ${Array.isArray(row.logic) ? row.logic.join("<br>") : ""}
`;

body.appendChild(card);

});

div.appendChild(header);
div.appendChild(body);

container.appendChild(div);

});

}

</script>

</body>
</html>
